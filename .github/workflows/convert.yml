name: Convert TXT to MDX

on:
  workflow_dispatch:
    inputs:
      directory:
        description: 'Directory to convert (default: input)'
        required: false
        default: 'input'
  push:
    paths:
      - 'input/**/*.txt'

jobs:
  convert:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Run conversion
        run: |
          echo "ðŸ¤– TXT to MDX Converter - Built by Claude (AI)"
          echo "ðŸ“‚ Converting files in: ${{ github.event.inputs.directory || 'input' }}"
          node txt-to-mdx.js "${{ github.event.inputs.directory || 'input' }}"
      
      - name: List converted files
        id: list-files
        run: |
          echo "ðŸ“ Converted files:"
          find input -name "*.mdx" -type f 2>/dev/null | while read file; do
            echo "  âœ… $file"
          done || echo "  No files found"
          
          # Count files
          MDX_COUNT=$(find input -name "*.mdx" -type f 2>/dev/null | wc -l || echo "0")
          echo "mdx_count=$MDX_COUNT" >> $GITHUB_OUTPUT
      
      - name: Upload converted MDX files
        uses: actions/upload-artifact@v4
        with:
          name: converted-mdx-files-${{ github.run_number }}
          path: |
            input/**/*.mdx
            ${{ github.event.inputs.directory }}/**/*.mdx
          if-no-files-found: warn
      
      - name: Generate summary
        run: |
          echo "## ðŸŽ‰ Conversion Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ¤– **å®Œå…¨ç”± AI æž„å»º** - Claude (Anthropic)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Conversion Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Total MDX files generated:** ${{ steps.list-files.outputs.mdx_count }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Source directory:** \`${{ github.event.inputs.directory || 'input' }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Converted Files" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          find input -name "*.mdx" -type f 2>/dev/null | while read file; do
            echo "- âœ… \`$file\`" >> $GITHUB_STEP_SUMMARY
          done || echo "- No files found" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ Download" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Download the converted files from the **Artifacts** section below." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ **Next Steps:**" >> $GITHUB_STEP_SUMMARY
          echo "1. Download the artifacts" >> $GITHUB_STEP_SUMMARY
          echo "2. Copy the \`.mdx\` files to your blog project" >> $GITHUB_STEP_SUMMARY
          echo "3. Publish your blog!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âš ï¸ **Reminder:** Please check the converted files before publishing." >> $GITHUB_STEP_SUMMARY
