name: Convert TXT to MDX

on:
  workflow_dispatch:
    inputs:
      input_directory:
        description: 'Input directory (default: input)'
        required: false
        default: 'input'
      output_directory:
        description: 'Output directory (default: output)'
        required: false
        default: 'output'
  push:
    paths:
      - 'input/**/*.txt'

jobs:
  convert:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Run conversion
        run: |
          echo "ðŸ¤– TXT to MDX Converter - Built by Claude (AI)"
          echo "ðŸ“‚ Input:  ${{ github.event.inputs.input_directory || 'input' }}"
          echo "ðŸ“‚ Output: ${{ github.event.inputs.output_directory || 'output' }}"
          node txt-to-mdx.js "${{ github.event.inputs.input_directory || 'input' }}" "${{ github.event.inputs.output_directory || 'output' }}"
      
      - name: List converted files
        id: list-files
        run: |
          echo "ðŸ“ Converted files:"
          OUTPUT_DIR="${{ github.event.inputs.output_directory || 'output' }}"
          find "$OUTPUT_DIR" -name "*.mdx" -type f 2>/dev/null | while read file; do
            echo "  âœ… $file"
          done || echo "  No files found"
          
          # Count files
          MDX_COUNT=$(find "$OUTPUT_DIR" -name "*.mdx" -type f 2>/dev/null | wc -l || echo "0")
          echo "mdx_count=$MDX_COUNT" >> $GITHUB_OUTPUT
      
      - name: Upload converted MDX files
        uses: actions/upload-artifact@v4
        with:
          name: converted-mdx-files-${{ github.run_number }}
          path: ${{ github.event.inputs.output_directory || 'output' }}/**/*.mdx
          if-no-files-found: warn
      
      - name: Generate summary
        run: |
          OUTPUT_DIR="${{ github.event.inputs.output_directory || 'output' }}"
          
          echo "## ðŸŽ‰ Conversion Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ¤– **å®Œå…¨ç”± AI æž„å»º** - Claude (Anthropic)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Conversion Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Total MDX files generated:** ${{ steps.list-files.outputs.mdx_count }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Input directory:** \`${{ github.event.inputs.input_directory || 'input' }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Output directory:** \`$OUTPUT_DIR\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Converted Files" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          find "$OUTPUT_DIR" -name "*.mdx" -type f 2>/dev/null | while read file; do
            echo "- âœ… \`$file\`" >> $GITHUB_STEP_SUMMARY
          done || echo "- No files found" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ Download" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Download the converted files from the **Artifacts** section below." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ **Next Steps:**" >> $GITHUB_STEP_SUMMARY
          echo "1. Download the artifacts" >> $GITHUB_STEP_SUMMARY
          echo "2. Extract and check the \`.mdx\` files in the \`$OUTPUT_DIR\` directory" >> $GITHUB_STEP_SUMMARY
          echo "3. Copy the files to your blog project" >> $GITHUB_STEP_SUMMARY
          echo "4. Publish your blog!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âš ï¸ **Reminder:** Please check the converted files before publishing." >> $GITHUB_STEP_SUMMARY
